async function wordCount(e,n){function t(e){return e.replace(/[|｜](.+?)《(.+?)》/g,"$1").replace(new RegExp("[｜|](.+?)《(.+?)》","g"),"$1").replace(new RegExp(`[｜|](.+?)((${c}+))`,"g"),"$1").replace(new RegExp(`(${l}+)（${c}+）`,"g"),"$1").replace(/[|｜]([《\(（])(.+?)([》\)）])/g,"$1$2$3").replace(/#(.+?)__(.+?)__#/g,"$1")}async function r(e,n){return new Promise(t=>{function r(){for(let a=0;a<Object.keys(n).length-1;a++)p[l]!==Object.keys(n)[a]&&!1===c?l<e.length-1?(l++,r()):t(g):p[l]!==Object.keys(n)[a]&&!0===c&&p[l]!==o?(g++,l<e.length-1?(l++,r()):t(g)):p[l]!==Object.keys(n)[a]&&!0===c&&p[l]===o?(g++,c=!1,l<e.length-1?(l++,r()):t(g)):p[l]===Object.keys(n)[a]&&!1===c?(g++,c=!0,o=n[Object.keys(n)[a]],l<e.length-1?(l++,r()):t(g)):p[l]===Object.keys(n)[a]&&!0===c?(g++,l<e.length-1?(l++,r()):t(g)):(console.error("フールプルーフが働きました"),l<e.length-1?(l++,r()):t(g))}let g=0,l=0,c=!1,o="",p=e.split("");r()})}function g(e,n){let t=void 0!==n?n:["。","！　","？　","‼　","⁉　","❕　","❗　","❔　","❓　","!　","\\?　"],r=new RegExp(`(?<=^|\r|\n|${t.join("|")}).+(\r|\n|${t.join("|")})`,"g"),g=e.match(r).map(e=>e.replace(/[\r\n　 \t]/g,"").length);return g.reduce((e,n)=>e+n,0)/g.length}let l="[々〇〻㐀-鿿豈-﫿\ud840-𯰀-\udfff]",c="[぀-ゟ゠-ヿ]",o=void 0===n||""===n?{"「":"」","『":"』","（":"）"}:n,p=t(e),a=p.replace(/[\r\n　 \t]/g,""),h=a.length,s=!!new RegExp(`${l}`).test(a),$=!0===s?a.match(new RegExp(`${l}`,"g")).join("").length:0;return r(a,o).then(e=>({total:h,kanji:$,parenthesis:e,letterLength:g(p)}))}