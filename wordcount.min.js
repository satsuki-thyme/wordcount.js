async function wordCount(e,n){function t(e){return e.replace(/[|｜](.+?)《(.+?)》/g,"$1").replace(new RegExp("[｜|](.+?)《(.+?)》","g"),"$1").replace(new RegExp(`[｜|](.+?)((${c}+))`,"g"),"$1").replace(new RegExp(`(${l}+)（${c}+）`,"g"),"$1").replace(/[|｜]([《\(（])(.+?)([》\)）])/g,"$1$2$3").replace(/#(.+?)__(.+?)__#/g,"$1")}async function g(e,n){return new Promise(t=>{function g(){for(let p=0;p<Object.keys(n).length-1;p++)h[l]!==Object.keys(n)[p]&&!1===c?l<e.length-1?(l++,g()):t(r):h[l]!==Object.keys(n)[p]&&!0===c&&h[l]!==o?(r++,l<e.length-1?(l++,g()):t(r)):h[l]!==Object.keys(n)[p]&&!0===c&&h[l]===o?(r++,c=!1,l<e.length-1?(l++,g()):t(r)):h[l]===Object.keys(n)[p]&&!1===c?(r++,c=!0,o=n[Object.keys(n)[p]],l<e.length-1?(l++,g()):t(r)):h[l]===Object.keys(n)[p]&&!0===c?(r++,l<e.length-1?(l++,g()):t(r)):(console.error("フールプルーフが働きました"),l<e.length-1?(l++,g()):t(r))}let r=0,l=0,c=!1,o="",h=e.split("");g()})}function r(e,n){let t=void 0!==n?n:["。","！　","？　","‼　","⁉　","❕　","❗　","❔　","❓　","!　","\\?　"],g=new RegExp(`(?<=^|\r|\n|${t.join("|")}).+(\r|\n|${t.join("|")})`,"g"),r=e.match(g)||[],l=[];return r.length>0?(l=r.map(e=>e.replace(/[\r\n　 \t]/g,"").length),l.reduce((e,n)=>e+n,0)/r.length):0}let l="[々〇〻㐀-鿿豈-﫿\ud840-𯰀-\udfff]",c="[぀-ゟ゠-ヿ]",o=void 0===n||""===n?{"「":"」","『":"』","（":"）"}:n,h=t(e),p=h.replace(/[\r\n　 \t]/g,""),a=p.length,s=!!new RegExp(`${l}`).test(p),$=!0===s?p.match(new RegExp(`${l}`,"g")).join("").length:0;return g(p,o).then(e=>({total:a,kanji:$,parenthesis:e,letterLength:r(h)}))}